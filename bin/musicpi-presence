#!/usr/bin/env python

import argparse, subprocess

from presence.main   import main
from presence.client import ClientThread

def call_mpc(command):
    ret = ''
    try:
        ret = subprocess.check_output(
            command.split(), stderr=subprocess.STDOUT)
    except:
        ret += 'Error executing "%s"' % command
    return ret

if __name__ == '__main__':
    name = 'musicpi-presence'
    parser = argparse.ArgumentParser(description=name)
    parser.add_argument( '-d', '--daemon',  action="store_true",
                         help='run as daemon')
    parser.add_argument( '-v', '--verbose', action="store_true",
                         help='')
    args = parser.parse_args()
    
    commands = {
        'mpc': ClientThread.make_command(
            func=staticmethod(lambda client, message: client.send_ascii(call_mpc(message.ascii))),
            helptext='call mpc',
            greedy=True),
        }
    
    client_args = {
        'name': 'musicpi',
        'downloaddir': '/media/ramdisk',
        'commands': commands }

    main(name, args.daemon, args.verbose, client_args)
